#!/bin/bash

# The `pre-command` hook will run just before your build command runs


set -euo pipefail # exit on failure or unset variable
set -v

# override curl options for Pkg artifacts
export CURL_HOME="$(dirname "$BUILDKITE_BUILD_CHECKOUT_PATH")"
printf -- "--retry 8\n" > "$CURL_HOME/.curlrc"


case "${BUILDKITE_AGENT_META_DATA_CONFIG}" in
    # standard configurations
    disabled)
        if [[ -f "Project.toml" ]]; then
            echo "--- Instantiating Julia project"
            # try to instantiate, only call build if this fails
            julia --color=yes --project "$BUILDKITE_HOOKS_PATH/instantiate.jl"
        fi
        ;;
esac

set +v
